{{ $images := .Get "images" }}
{{ $interval := .Get "interval" | default "7000" }}
{{ $customClasses := .Get "classes" | default "" }}

{{ $imageList := split $images "," }}
{{ $firstImage := index $imageList 0 }}

<div class="image-fade-slider {{ $customClasses }}"
     data-images='{{ jsonify $imageList }}'
     data-interval='{{ $interval }}'
     style="background-image:url({{ $firstImage }});">
    <img alt="" src="{{ $firstImage }}" class="image" />
</div>

<script>
    (function() {
        const sliders = document.querySelectorAll('.image-fade-slider');

        sliders.forEach(slider => {
            const images = JSON.parse(slider.getAttribute('data-images'));
            const interval = parseInt(slider.getAttribute('data-interval'), 10) || 5000;
            let index = 0;

            setInterval(() => {
                index = (index + 1) % images.length;
                slider.style.backgroundImage = `url(${images[index]})`;

                slider.children[0].classList.add('fade-out');
                setTimeout(() => {
                    slider.children[0].src = `${images[index]}`;
                }, 100);

                slider.children[0].onload = () => {
                    slider.children[0].classList.remove('fade-out');
                };
            }, interval);
        });
    })();
</script>
